<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test de compatibilit√© WebXR</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #666;
        }
        .success {
            background: #1e4620;
            border-left-color: #4caf50;
        }
        .error {
            background: #4a1e1e;
            border-left-color: #f44336;
        }
        .warning {
            background: #4a3a1e;
            border-left-color: #ff9800;
        }
        h1 {
            color: #4fc3f7;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .code {
            background: #0d1117;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîç Test de compatibilit√© WebXR</h1>
    
    <div id="results"></div>
    
    <h2>Actions</h2>
    <button onclick="runAllTests()">üîÑ Relancer tous les tests</button>
    <button onclick="testVRSession()">ü•Ω Tester session VR</button>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(type, title, message) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            results.appendChild(div);
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        async function runAllTests() {
            clearResults();
            
            // Test 1: Navigator pr√©sent
            if (navigator) {
                addResult('success', '‚úì Navigator', 'API Navigator disponible');
            } else {
                addResult('error', '‚úó Navigator', 'API Navigator non disponible');
                return;
            }
            
            // Test 2: WebXR pr√©sent
            if (navigator.xr) {
                addResult('success', '‚úì WebXR API', 'API WebXR disponible dans ce navigateur');
            } else {
                addResult('error', '‚úó WebXR API', 'API WebXR non disponible. Utilisez Chrome, Edge ou Firefox r√©cent.');
                return;
            }
            
            // Test 3: Support immersive-vr
            try {
                const supported = await navigator.xr.isSessionSupported('immersive-vr');
                if (supported) {
                    addResult('success', '‚úì Mode VR immersif', 'Votre syst√®me supporte le mode VR immersif');
                } else {
                    addResult('warning', '‚ö† Mode VR immersif', 'Mode VR non support√©. Assurez-vous qu\'un casque VR est connect√© et que le runtime est d√©marr√©.');
                }
            } catch (error) {
                addResult('error', '‚úó Mode VR immersif', `Erreur: ${error.message}`);
            }
            
            // Test 4: Support inline
            try {
                const supported = await navigator.xr.isSessionSupported('inline');
                if (supported) {
                    addResult('success', '‚úì Mode inline', 'Mode inline support√© (vue 3D dans la page)');
                } else {
                    addResult('warning', '‚ö† Mode inline', 'Mode inline non support√©');
                }
            } catch (error) {
                addResult('error', '‚úó Mode inline', `Erreur: ${error.message}`);
            }
            
            // Test 5: HTTPS ou localhost
            const isSecure = window.location.protocol === 'https:' || 
                           window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
            if (isSecure) {
                addResult('success', '‚úì Contexte s√©curis√©', `Protocole: ${window.location.protocol}, H√¥te: ${window.location.hostname}`);
            } else {
                addResult('error', '‚úó Contexte s√©curis√©', 'WebXR n√©cessite HTTPS ou localhost. Utilisez http://localhost au lieu de l\'adresse IP.');
            }
            
            // Test 6: User agent
            const ua = navigator.userAgent;
            addResult('success', '‚Ñπ Navigateur', `<div class="code">${ua}</div>`);
            
            // Test 7: R√©f√©rence spaces support√©s
            addResult('success', '‚Ñπ Info', 'Pour tester une session compl√®te, cliquez sur "Tester session VR"');
        }
        
        async function testVRSession() {
            clearResults();
            addResult('warning', '‚è≥ Test en cours', 'Tentative de cr√©ation d\'une session VR...');
            
            try {
                if (!navigator.xr) {
                    throw new Error('WebXR non disponible');
                }
                
                // Tester avec configuration minimale
                const session = await navigator.xr.requestSession('immersive-vr', {
                    requiredFeatures: ['local-floor'],
                    optionalFeatures: []
                });
                
                addResult('success', '‚úì Session VR cr√©√©e', 'Session VR cr√©√©e avec succ√®s avec configuration minimale !');
                
                // Informations sur la session
                const refSpace = await session.requestReferenceSpace('local-floor');
                addResult('success', '‚úì Reference space', 'Reference space "local-floor" cr√©√© avec succ√®s');
                
                // Fermer la session
                setTimeout(async () => {
                    await session.end();
                    addResult('success', '‚úì Session ferm√©e', 'Session VR ferm√©e proprement');
                }, 2000);
                
            } catch (error) {
                addResult('error', '‚úó Session VR', `Impossible de cr√©er la session: ${error.message}`);
                
                if (error.message.includes('session')) {
                    addResult('warning', 'üí° Solution', `
                        <strong>Solutions possibles:</strong><br>
                        1. Red√©marrez votre casque VR<br>
                        2. Red√©marrez le runtime VR (Oculus, SteamVR, WMR)<br>
                        3. Red√©marrez le navigateur<br>
                        4. V√©rifiez que le casque est bien d√©tect√©<br>
                        5. Essayez avec un autre navigateur (Chrome/Edge)
                    `);
                }
            }
        }
        
        // Lancer les tests au chargement
        window.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>
