<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Diagnostic WebXR - Quest 3</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #ffffff;
        }
        .test-section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #005a9e;
        }
        #results {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üîç Diagnostic WebXR pour Meta Quest 3</h1>
    
    <div class="test-section">
        <h2>√âtape 1 : Tests Automatiques</h2>
        <button onclick="runDiagnostics()">‚ñ∂Ô∏è Lancer le Diagnostic Complet</button>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>√âtape 2 : Test Session VR</h2>
        <button onclick="testVRSession()">ü•Ω Tester une Session VR</button>
        <div id="vrResults"></div>
    </div>

    <div class="test-section">
        <h2>√âtape 3 : Informations Syst√®me</h2>
        <button onclick="showSystemInfo()">‚ÑπÔ∏è Afficher Infos Syst√®me</button>
        <div id="systemInfo"></div>
    </div>

    <script>
        async function runDiagnostics() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'üîÑ Diagnostic en cours...\n\n';
            let output = '';

            // Test 1 : V√©rifier navigator.xr
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += 'üìã TEST 1 : API WebXR\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            if (navigator.xr) {
                output += '‚úÖ navigator.xr existe\n';
            } else {
                output += '‚ùå navigator.xr n\'existe PAS\n';
                output += '   ‚Üí WebXR n\'est pas disponible dans ce navigateur\n';
                output += '   ‚Üí Utilisez Chrome ou Edge version 90+\n';
                resultsDiv.innerHTML = output;
                return;
            }

            // Test 2 : Support immersive-vr
            output += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += 'üìã TEST 2 : Support immersive-vr\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            try {
                const vrSupported = await navigator.xr.isSessionSupported('immersive-vr');
                if (vrSupported) {
                    output += '‚úÖ immersive-vr est SUPPORT√â\n';
                    output += '   ‚Üí Votre casque est correctement d√©tect√©!\n';
                } else {
                    output += '‚ùå immersive-vr n\'est PAS support√©\n';
                    output += '   ‚Üí Le casque n\'est pas d√©tect√© par le navigateur\n';
                    output += '\nüîß SOLUTIONS √Ä ESSAYER :\n';
                    output += '   1. Red√©marrez l\'application Oculus/Meta Quest\n';
                    output += '   2. D√©branchez et rebranchez le casque\n';
                    output += '   3. Dans l\'app Meta Quest PC, allez dans Param√®tres > G√©n√©ral\n';
                    output += '      et activez "Runtime OpenXR inconnu"\n';
                    output += '   4. D√©finissez Oculus comme runtime OpenXR actif\n';
                    output += '   5. Red√©marrez Chrome compl√®tement\n';
                }
            } catch (e) {
                output += '‚ùå ERREUR lors du test : ' + e.message + '\n';
            }

            // Test 3 : Support immersive-ar
            output += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += 'üìã TEST 3 : Support immersive-ar\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            try {
                const arSupported = await navigator.xr.isSessionSupported('immersive-ar');
                output += (arSupported ? '‚úÖ' : '‚ùå') + ' immersive-ar : ' + arSupported + '\n';
            } catch (e) {
                output += '‚ùå ERREUR : ' + e.message + '\n';
            }

            // Test 4 : Support inline
            output += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += 'üìã TEST 4 : Support inline (mode fen√™tre)\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            try {
                const inlineSupported = await navigator.xr.isSessionSupported('inline');
                output += (inlineSupported ? '‚úÖ' : '‚ùå') + ' inline : ' + inlineSupported + '\n';
            } catch (e) {
                output += '‚ùå ERREUR : ' + e.message + '\n';
            }

            resultsDiv.innerHTML = output;
        }

        async function testVRSession() {
            const resultsDiv = document.getElementById('vrResults');
            resultsDiv.innerHTML = 'üîÑ Test de session VR en cours...\n\n';
            let output = '';

            try {
                output += 'üöÄ Tentative de cr√©ation d\'une session VR...\n';
                const session = await navigator.xr.requestSession('immersive-vr', {
                    optionalFeatures: ['local-floor', 'bounded-floor', 'hand-tracking', 'layers']
                });
                
                output += '‚úÖ SESSION VR CR√â√âE AVEC SUCC√àS!\n\n';
                output += 'üìä Informations de la session :\n';
                output += '   - Mode : ' + session.mode + '\n';
                output += '   - RenderState : ' + JSON.stringify(session.renderState, null, 2) + '\n';
                
                // Fermer la session
                await session.end();
                output += '\n‚úÖ Session ferm√©e proprement\n';
                output += '\nüéâ VOTRE CASQUE FONCTIONNE PARFAITEMENT!\n';
                output += '   Le probl√®me vient de la configuration Babylon.js\n';
                
            } catch (error) {
                output += '‚ùå √âCHEC de cr√©ation de session VR\n\n';
                output += 'üìã D√©tails de l\'erreur :\n';
                output += '   - Type : ' + error.name + '\n';
                output += '   - Message : ' + error.message + '\n\n';
                
                if (error.name === 'NotSupportedError') {
                    output += 'üîß DIAGNOSTIC : NotSupportedError\n';
                    output += '   ‚Üí Le navigateur ne d√©tecte pas le casque\n\n';
                    output += '   √âTAPES √Ä SUIVRE :\n';
                    output += '   1. Ouvrez l\'application Oculus/Meta Quest sur PC\n';
                    output += '   2. Allez dans Param√®tres > G√©n√©ral > OpenXR Runtime\n';
                    output += '   3. Cliquez sur "D√©finir Oculus comme runtime OpenXR actif"\n';
                    output += '   4. Red√©marrez Chrome COMPL√àTEMENT (fermez toutes les fen√™tres)\n';
                    output += '   5. V√©rifiez que le casque est bien en mode Link (pas en mode autonome)\n';
                } else if (error.name === 'SecurityError') {
                    output += 'üîß DIAGNOSTIC : SecurityError\n';
                    output += '   ‚Üí Probl√®me de s√©curit√©/permissions\n';
                    output += '   ‚Üí Utilisez HTTPS ou localhost\n';
                } else if (error.name === 'InvalidStateError') {
                    output += 'üîß DIAGNOSTIC : InvalidStateError\n';
                    output += '   ‚Üí Le casque n\'est pas pr√™t\n';
                    output += '   ‚Üí Mettez le casque et attendez l\'environnement Link\n';
                }
            }

            resultsDiv.innerHTML = output;
        }

        function showSystemInfo() {
            const infoDiv = document.getElementById('systemInfo');
            let output = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += 'üíª INFORMATIONS SYST√àME\n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            output += 'üåê Navigateur :\n';
            output += '   ' + navigator.userAgent + '\n\n';
            
            output += 'üîí Protocole :\n';
            output += '   ' + window.location.protocol + '\n';
            output += '   ' + (window.location.protocol === 'https:' || window.location.hostname === 'localhost' ? '‚úÖ S√©curis√©' : '‚ö†Ô∏è Non s√©curis√© - WebXR n√©cessite HTTPS') + '\n\n';
            
            output += 'üìç Hostname :\n';
            output += '   ' + window.location.hostname + '\n\n';
            
            output += 'üîß APIs Disponibles :\n';
            output += '   - WebXR : ' + (navigator.xr ? '‚úÖ' : '‚ùå') + '\n';
            output += '   - WebGL : ' + (window.WebGLRenderingContext ? '‚úÖ' : '‚ùå') + '\n';
            output += '   - WebGL2 : ' + (window.WebGL2RenderingContext ? '‚úÖ' : '‚ùå') + '\n';
            
            infoDiv.innerHTML = output;
        }

        // Lancer automatiquement au chargement
        window.addEventListener('load', () => {
            setTimeout(runDiagnostics, 500);
        });
    </script>
</body>
</html>
